<!doctype html>
<html lang="kr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>REST API Practice</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/5d0066b8f6.js" crossorigin="anonymous"></script>  
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Noto+Sans+KR:wght@100..900&display=swap" rel="stylesheet">
    <style>
        body {
          background-image: url('mountain.png'); background-size:cover;
          background-repeat: no-repeat; /* 반복 없음 */
          background-attachment: fixed; /* 스크롤 시 배경 고정 */
        }
        h1 {
        color: darkgreen;
        font-weight: bold; /* 굵게 설정 */
        }
        p {
            color: white; /* 흰색으로 설정 */
            font-weight: bold; /* 굵게 설정 */
        }
        </style>
  </head>
  <body class="container">
    <h1 style="margin-top: 50px;" >List of Mountains in S.Korea</h1>
    <!--<img src="./mountain.png" alt="my image" height="200">-->
    <form>
        <div class="mb-3">
            <label for="inputName" class="form-label" style="margin-top: 25px;">Mountain <i class="fa-solid fa-mountain-sun"></i></label>
            <input type="text" class="form-control" id="inputName" style="width:30%"aria-describedby="emailHelp">
          </div>
        <div class="mb-3">
          <label for="inputHeight" class="form-label">Altitude <i class="fa-solid fa-cloud-arrow-up"></i></label>
          <input type="text" class="form-control" id="inputHeight" style="width:30%"aria-describedby="emailHelp">
        </div>
        <div class="mb-3">
          <label for="inputPlace" class="form-label">Location <i class="fa-solid fa-location-dot"></i></label>
          <input type="text" class="form-control" id="inputPlace" style="width:30%"aria-describedby="emailHelp">
        </div>
        <div class="mb-3">
          <label for="inputDescription" class="form-label">Description <i class="fa-solid fa-circle-info"></i></label>
          <input type="text" class="form-control" id="inputDescription" style="width:30%"aria-describedby="emailHelp">
        </div>
        
      </form>
      <button type="submit" class="btn btn-success" onclick="getJsonData()">Search</button>
      <button type="submit" class="btn btn-success" style="margin-left: 15px;" onclick="getMyListData()">MyList</button>
      <button type="submit" class="btn btn-success" style="margin-left: 15px;" onclick="postJsonData()">Add</button>
      <button type="submit" class="btn btn-success" style="margin-left: 15px;" onclick="putJsonData()">Update</button>
      <button type="submit" class="btn btn-success" style="margin-left: 15px;" onclick="deleteJsonData()">Delete</button>
    </p>
      <br />
      <div id="json"></div>

      <script>
        async function getJsonData() {
            const name = document.getElementById("inputName").value;
            const place = document.getElementById("inputPlace").value;
            //const url = name ? `http://localhost:3000/posts/${name}` : 'http://localhost:3000/posts';
            const url = (name || place) ? `http://localhost:3000/posts?name=${encodeURIComponent(name)}&place=${encodeURIComponent(place)}` : 'http://localhost:3000/posts';

            const response = await fetch(url, {
                method: "GET",
                headers: {
                    "Content-Type": "application/json"
                },
            });

            if (!response.ok) {
                console.error(`Error: ${response.status}`);
                return;
            }

            const jsonData = await response.json();

            let parentTag = document.getElementById("json");
            parentTag.replaceChildren();

            if (Array.isArray(jsonData)) {
                // Display all posts
                jsonData.forEach(post => {
                    let childTag_Name = document.createElement('p');
                    let childTag_Height = document.createElement('p');
                    let childTag_Place = document.createElement('p');
                    let childTag_Description = document.createElement('p');

                    childTag_Name.innerHTML = "산명 : " + (post.Name || 'N/A') + "<br />";
                    childTag_Height.innerHTML = "높이 : " + (post.Height || 'N/A') + "<br />";
                    childTag_Place.innerHTML = "지역 : " + (post.Place || 'N/A') + "<br />";
                    childTag_Description.innerHTML = "설명 : " + (post.Description || 'N/A') + "<br />";

                    parentTag.appendChild(childTag_Name);
                    parentTag.appendChild(childTag_Height);
                    parentTag.appendChild(childTag_Place);
                    parentTag.appendChild(childTag_Description);
                });
            } else {
                // Display a single post
                let childTag_Name = document.createElement('p');
                let childTag_Height = document.createElement('p');
                let childTag_Place = document.createElement('p');
                let childTag_Description = document.createElement('p');

                childTag_Name.innerHTML = "산명 : " + (jsonData.Name || 'N/A') + "<br />";
                childTag_Height.innerHTML = "높이 : " + (jsonData.Height || 'N/A') + "<br />";
                childTag_Place.innerHTML = "지역 : " + (jsonData.Place || 'N/A') + "<br />";
                childTag_Description.innerHTML = "설명 : " + (jsonData.Description || 'N/A') + "<br />";

                parentTag.appendChild(childTag_Name);
                parentTag.appendChild(childTag_Height);
                parentTag.appendChild(childTag_Place);
                parentTag.appendChild(childTag_Description);
            }
        }

       // db 데이터 조회
        async function getMyListData() {
            try {
                const response = await fetch('http://localhost:3000/mylist', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                });

                if (!response.ok) {
                    console.error(`Error: ${response.status}`);
                    return;
                }

                const jsonData = await response.json();

                // 받아온 데이터를 콘솔에 출력
                console.log(jsonData);

                let parentTag = document.getElementById("json");
                parentTag.replaceChildren();

                if (Array.isArray(jsonData) && jsonData.length > 0) {
                    jsonData.forEach(post => {
                        displayPost(parentTag, post);
                    });
                } else if (!Array.isArray(jsonData) && Object.keys(jsonData).length > 0) {
                    displayPost(parentTag, jsonData);
                } else {
                    // 데이터가 없는 경우에 대한 처리
                    let noDataMessage = document.createElement('p');
                    noDataMessage.innerHTML = "데이터가 없습니다.";
                    parentTag.appendChild(noDataMessage);
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function displayPost(parentTag, post) {
            let childTag = document.createElement('p');
            childTag.innerHTML = `번호: ${post.list_number || 'N/A'} | 산명: ${post.mountain_name || 'N/A'} | 높이: ${post.height || 'N/A'} | 지역: ${post.place || 'N/A'} | 설명: ${post.description || 'N/A'}<br />`;

            parentTag.appendChild(childTag);
        }


        //쓰기
        async function postJsonData() {
            const name = document.getElementById("inputName").value;
            const height = document.getElementById("inputHeight").value;
            const place = document.getElementById("inputPlace").value;
            const description = document.getElementById("inputDescription").value;

            // Check if any of the fields is empty
            if (!name || !height || !place || !description) {
                alert("모든 필드를 입력해주세요.");
                return;
            }
            
            const response = await fetch("http://localhost:3000/regist", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    "name": name,
                    "height": height,
                    "place": place,
                    "description": description
                })
            });

            if (!response.ok) {
                console.error(`Error: ${response.status}`);
                return;
            }

            const jsonData = await response.json();

            // Reset input fields
            document.getElementById("inputName").value = "";
            document.getElementById("inputHeight").value = "";
            document.getElementById("inputPlace").value = "";
            document.getElementById("inputDescription").value = "";

            let parentTag = document.getElementById("json");
            parentTag.replaceChildren();

            let childTag_Name = document.createElement('p');
            let childTag_Height = document.createElement('p');
            let childTag_Place = document.createElement('p');
            let childTag_Description = document.createElement('p');

            childTag_Name.innerHTML = "산명 : " + (jsonData.name || 'N/A') + "<br />";
            childTag_Height.innerHTML = "높이 : " + (jsonData.height || 'N/A') + "<br />";
            childTag_Place.innerHTML = "지역 : " + (jsonData.place || 'N/A') + "<br />";
            childTag_Description.innerHTML = "설명 : " + (jsonData.description || 'N/A') + "<br />";

            parentTag.appendChild(childTag_Name);
            parentTag.appendChild(childTag_Height);
            parentTag.appendChild(childTag_Place);
            parentTag.appendChild(childTag_Description);
        }



        // DB 데이터를 수정
        async function putJsonData() {
            const name = document.getElementById("inputName").value;
            const height = document.getElementById("inputHeight").value;
            const place = document.getElementById("inputPlace").value;
            const description = document.getElementById("inputDescription").value;

            const response = await fetch(`http://localhost:3000/mylist/${name}`, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    "Height": height,
                    "Place": place,
                    "Description": description
                })
            });

            if (!response.ok) {
                console.error(`Error: ${response.status}`);
                return;
            }

            const jsonData = await response.json();

            // 수정된 데이터를 화면에 표시
            let parentTag = document.getElementById("json");
            parentTag.replaceChildren();
            let childTag_Height = document.createElement('p');
            let childTag_Place = document.createElement('p');
            let childTag_Description = document.createElement('p');

            childTag_Height.innerHTML = "높이 : " + jsonData.Height + "<br />";
            childTag_Place.innerHTML = "지역 : " + jsonData.Place + "<br />";
            childTag_Description.innerHTML = "설명 : " + jsonData.Description + "<br />";

            parentTag.appendChild(childTag_Height);
            parentTag.appendChild(childTag_Place);
            parentTag.appendChild(childTag_Description);

             // 수정 성공 메시지를 표시
           alert("정보가 성공적으로 수정되었습니다.");
        }



        // mylist data 삭제
        async function deleteJsonData() {
            const name = document.getElementById("inputName").value;
            const response = await fetch(`http://localhost:3000/mylist/${name}`, {
                method: "DELETE",
                headers: {
                    "Content-Type": "application/json"
                },
            });

            if (response.ok) {
                // 삭제 성공 시 메시지 표시
                alert(`정보 "${name}" 이(가) 성공적으로 삭제되었습니다.`);
            } else {
                // 삭제 실패 시 에러 메시지 표시
                const errorData = await response.json();
                alert(`삭제 오류: ${errorData.error || "알 수 없는 오류"}`);
            }

            // 화면을 초기화하거나 다른 작업을 수행할 수 있음
            let parentTag = document.getElementById("json");
            parentTag.replaceChildren();
        }

    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  </body>
</html> 